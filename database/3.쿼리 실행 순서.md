# 쿼리 실행 절차
![image](https://github.com/jekyllPark/back-to-basic/assets/114489012/975a1b99-d96f-419a-b15e-12cd2102fffe)
> MySQL 서버에서 쿼리가 실행되는 과정은 크게 세 단계로 나눌 수 있다.
> 1. SQL문을 잘게 쪼개서 MySQL Server가 이해할 수 있는 수준으로 분리(파스 트리)한다.
> 2. SQL의 파싱 정보(파스 트리)를 확인하면서 어떤 테이블부터 읽고 어떤 인덱스를 이용할 지 선택한다.
> 3. 2번째 단계에서 결정된 테이블의 읽기 순서나 선택된 인덱스를 이용해 Storage Engine에서 데이터를 가져온다.

**첫 번째 단계**는 SQL 파싱(Parsing)이라고 한다. MySQL Server의 **SQL 파서**라는 모듈로 처리한다. SQL 문법이 잘못되었다면 이 단계에서 걸러진다. 또한 해당 단계에서 SQL **파스 트리**가 만들어진다.

MySQL Server가 실제로 쿼리를 실행할 때는 SQL 문장이 아니라 SQL 파스 트리를 사용해서 쿼리를 실행한다.

**두 번째 단계**는 첫 번째 단계에서 만들어진 SQL 파스 트리를 참조해서 다음의 내용을 처리한다.

- 불필요한 조건 제거 및 복잡한 연산의 단순화
- 여러 테이블의 조인이 있는 경우 어떤 순서로 테이블을 읽을지 결정
- 각 테이블에 사용된 조건과 인덱스 통계 정보를 이용해 사용할 인덱스를 결정
- 가져온 레코드들을 임시 테이블에 넣고 다시 한번 가공해야 하는지 결정

물론 이 밖에도 수많은 처리를 한다. 해당 단계는 **최적화 및 실행 계획 수립 단계**이며, MySQL Server의 Optimizer에서 처리한다.

**세 번 째 단계**는 수립된 계획대로 스토리지 엔진에서 레코드를 읽어오도록 요청하고, MySQL 엔진에서는 스토리지 엔진으로부터 받은 레코드를 조인하거나 정렬하는 작업을 수행한다.

첫 번째, 두 번째 단계는 주로 MySQL 엔진에서 처리하며, 세 번째 단계는 MySQL 엔진과 스토리지 엔진이 함께 처리한다.
